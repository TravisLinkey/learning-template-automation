---
interface Props {
	currentChapter: number;
	currentLesson: number | string;
	prevLesson?: { chapter: number; lesson: number | string; title: string; slug: string; subject?: string };
	nextLesson?: { chapter: number; lesson: number | string; title: string; slug: string; subject?: string };
	subject?: string;
}

const { currentChapter, currentLesson, prevLesson, nextLesson, subject } = Astro.props;

const getLessonPath = (chapter: number, lesson: number | string, lessonSubject?: string) => {
	const base = import.meta.env.BASE_URL;
	const subjectPrefix = lessonSubject ? `${lessonSubject}/` : '';
	if (lesson === 'x') {
		return `${base}${subjectPrefix}quiz/${chapter}.x`;
	}
	return `${base}${subjectPrefix}lessons/${chapter}.${lesson}`;
};

const getTocPath = () => {
	const base = import.meta.env.BASE_URL;
	if (subject) {
		return `${base}${subject}/`;
	}
	return base;
};
---

<nav class="navigation">
	<div class="nav-section">
		{prevLesson ? (
			<a href={getLessonPath(prevLesson.chapter, prevLesson.lesson, prevLesson.subject)} class="nav-link prev">
				<span class="nav-label">Previous lesson:</span>
				<span class="nav-title">{prevLesson.chapter}.{prevLesson.lesson} {prevLesson.title}</span>
			</a>
		) : (
			<span class="nav-link prev disabled">
				<span class="nav-label">Previous lesson:</span>
				<span class="nav-title">No previous lesson</span>
			</span>
		)}
	</div>

	<div class="nav-section">
		<a href={getTocPath()} class="nav-link toc">Back to table of contents</a>
	</div>

	<div class="nav-section">
		{nextLesson ? (
			<a href={getLessonPath(nextLesson.chapter, nextLesson.lesson, nextLesson.subject)} class="nav-link next">
				<span class="nav-label">Next lesson:</span>
				<span class="nav-title">{nextLesson.chapter}.{nextLesson.lesson} {nextLesson.title}</span>
			</a>
		) : (
			<span class="nav-link next disabled">
				<span class="nav-label">Next lesson:</span>
				<span class="nav-title">No next lesson</span>
			</span>
		)}
	</div>
</nav>

<style>
	.navigation {
		margin-top: 3.5rem;
		padding-top: 2rem;
		border-top: 2px solid #e8e8e8;
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		align-items: stretch;
		gap: 1rem;
		background-color: #fafbfc;
		padding: 1.5rem;
		border-radius: 6px;
		margin-bottom: 2rem;
		transition: background-color 0.3s, border-color 0.3s;
	}

	.nav-section {
		display: flex;
		flex: 1;
	}

	.nav-section:first-child {
		justify-content: flex-start;
	}

	.nav-section:nth-child(2) {
		justify-content: center;
	}

	.nav-section:last-child {
		justify-content: flex-end;
	}

	.nav-link {
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: flex-start;
		padding: 1rem;
		color: #2980b9;
		text-decoration: none;
		border-radius: 4px;
		transition: all 0.2s;
		background-color: #fff;
		border: 1px solid #e0e0e0;
		min-width: 0;
		flex: 1;
		max-width: 100%;
		min-height: 80px;
		transition: all 0.3s;
	}

	.nav-link:hover:not(.disabled) {
		background-color: #f0f7ff;
		border-color: #3498db;
		text-decoration: none;
		transform: translateY(-1px);
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
	}

	.nav-link.disabled {
		color: #95a5a6;
		cursor: default;
		background-color: #f8f9fa;
		border-color: #e8e8e8;
	}

	.nav-label {
		font-size: 0.8125rem;
		color: #7f8c8d;
		margin-bottom: 0.375rem;
		text-transform: uppercase;
		letter-spacing: 0.5px;
		font-weight: 600;
	}

	.nav-link.disabled .nav-label {
		color: #bdc3c7;
	}

	.nav-title {
		font-weight: 500;
		color: #2c3e50;
		font-size: 0.95rem;
		line-height: 1.4;
		word-wrap: break-word;
		overflow-wrap: break-word;
	}

	.nav-link.disabled .nav-title {
		color: #95a5a6;
	}

	.nav-link.next {
		align-items: flex-start;
		text-align: left;
	}

	.nav-link.toc {
		align-items: center;
		text-align: center;
		justify-content: center;
		background-color: #3498db;
		color: #fff;
		border-color: #2980b9;
		font-weight: 500;
		flex: 0 0 auto;
		min-width: 180px;
	}

	.nav-link.toc:hover {
		background-color: #2980b9;
		color: #fff;
		text-decoration: none;
	}

	.nav-link.toc .nav-label {
		color: rgba(255, 255, 255, 0.9);
	}

	.nav-link.toc .nav-title {
		color: #fff;
	}

	.nav-link.prev {
		align-items: flex-end;
		text-align: right;
	}

	@media (max-width: 768px) {
		.navigation {
			margin-top: 2.5rem;
			padding: 1.25rem;
			gap: 0.75rem;
			flex-direction: column;
		}

		.nav-section {
			justify-content: stretch !important;
		}

		.nav-link {
			padding: 0.875rem;
			max-width: 100%;
		}

		.nav-link.toc {
			min-width: auto;
		}
	}

	/* Dark mode styles */
	:global(html.dark) .navigation {
		background-color: #2a2a2a;
		border-top-color: #444;
	}

	:global(html.dark) .nav-link {
		background-color: #333;
		border-color: #444;
		color: #5dade2;
	}

	:global(html.dark) .nav-link:hover:not(.disabled) {
		background-color: #3a3a3a;
		border-color: #3498db;
		color: #85c1e9;
	}

	:global(html.dark) .nav-link.disabled {
		background-color: #2a2a2a;
		border-color: #444;
		color: #666;
	}

	:global(html.dark) .nav-label {
		color: #999;
	}

	:global(html.dark) .nav-link.disabled .nav-label {
		color: #555;
	}

	:global(html.dark) .nav-title {
		color: #d0d0d0;
	}

	:global(html.dark) .nav-link.disabled .nav-title {
		color: #666;
	}

	:global(html.dark) .nav-link.toc {
		background-color: #3498db;
		border-color: #2980b9;
		color: #fff;
	}

	:global(html.dark) .nav-link.toc:hover {
		background-color: #2980b9;
		color: #fff;
	}

	:global(html.dark) .nav-link.toc .nav-label {
		color: rgba(255, 255, 255, 0.9);
	}

	:global(html.dark) .nav-link.toc .nav-title {
		color: #fff;
	}
</style>

