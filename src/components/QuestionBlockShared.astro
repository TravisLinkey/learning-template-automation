---
/**
 * Shared question-block styling and wrap script for both lesson content and chapter quizzes.
 * Uses CSS variables (--qb-*) defined in BaseLayout.astro as the single source of theme truth.
 * No dark-mode overrides here â€“ the layout sets the variables for light/dark.
 */
---

<style is:global>
	/* Question block: all colors from theme variables (set in BaseLayout) */
	.question-block {
		border: 1px solid var(--qb-border);
		border-radius: 8px;
		padding: 1.25rem;
		margin: 1.5rem 0;
		background-color: var(--qb-bg);
		color: var(--qb-color);
		transition: background-color 0.3s, border-color 0.3s, color 0.3s;
	}

	.question-block details {
		margin-bottom: 0;
	}

	.question-block p,
	.question-block li,
	.question-block strong,
	.question-block span,
	.question-block h2,
	.question-block h3,
	.question-block h4 {
		color: var(--qb-color);
	}

	.question-block code {
		background-color: var(--qb-code-bg);
		border: 1px solid var(--qb-code-border);
		color: var(--qb-code-color);
	}

	.question-block pre {
		background-color: var(--qb-pre-bg);
		border: 1px solid var(--qb-pre-border);
	}

	.question-block pre code {
		background-color: transparent;
		color: var(--qb-pre-code);
	}

	/* Details (Show Hint / Show Solution): theme variables */
	.lesson-content details,
	.quiz-content details {
		margin: 1.25rem 0;
		border: 1px solid var(--qb-details-border);
		border-radius: 6px;
		overflow: hidden;
		background-color: var(--qb-details-bg);
		transition: background-color 0.3s, border-color 0.3s;
	}

	.question-block details {
		margin-top: 0.5rem;
	}

	.lesson-content details summary,
	.quiz-content details summary {
		list-style: none;
		cursor: pointer;
		padding: 0.6rem 1rem;
		font-weight: 500;
		color: var(--qb-details-summary);
		transition: background-color 0.2s, color 0.2s;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 0.5rem;
	}

	.lesson-content details summary::-webkit-details-marker,
	.quiz-content details summary::-webkit-details-marker {
		display: none;
	}

	.lesson-content details summary:hover,
	.quiz-content details summary:hover {
		background-color: var(--qb-details-summary-hover-bg);
		color: var(--qb-details-summary-hover);
	}

	.lesson-content details[open] summary,
	.quiz-content details[open] summary {
		border-bottom: 1px solid var(--qb-details-border);
	}

	.lesson-content details summary::after,
	.quiz-content details summary::after {
		content: '';
		flex-shrink: 0;
		width: 0.5rem;
		height: 0.5rem;
		border: solid currentColor;
		border-width: 0 2px 2px 0;
		transform: rotate(-45deg);
		transition: transform 0.25s ease;
	}

	.lesson-content details[open] summary::after,
	.quiz-content details[open] summary::after {
		transform: rotate(135deg);
	}

	.lesson-content details > *:not(summary),
	.quiz-content details > *:not(summary) {
		padding: 1rem 1.25rem;
		margin: 0;
		color: var(--qb-details-content);
	}
</style>

<script>
	// @ts-ignore - rootId is string (element id)
	function wrapQuestionBlocks(rootId) {
		const root = document.getElementById(rootId);
		if (!root) return;

		root.querySelectorAll('details').forEach((details) => {
			const summary = details.querySelector('summary');
			if (!summary) return;
			const t = summary.textContent?.trim() || '';
			if (!t.includes('Show Solution') && !t.includes('Show Hint')) return;
			if (details.closest('.question-block')) return;

			const toWrap = [];
			let prev = details.previousElementSibling;

			while (prev) {
				toWrap.unshift(prev);
				const text = prev.textContent || '';
				if (/Question\s*#?\s*\d+/i.test(text) || prev.tagName === 'H2' || prev.tagName === 'H3') break;
				if (prev.tagName === 'DETAILS') break;
				prev = prev.previousElementSibling;
			}

			const block = document.createElement('div');
			block.className = 'question-block';
			const first = toWrap[0];
			if (first?.parentNode) {
				first.parentNode.insertBefore(block, first);
				toWrap.forEach((el) => block.appendChild(el));
			} else if (details.parentNode) {
				details.parentNode.insertBefore(block, details);
			}
			block.appendChild(details);
		});
	}

	document.addEventListener('DOMContentLoaded', () => {
		wrapQuestionBlocks('lesson-content-root');
		wrapQuestionBlocks('quiz-content-root');
	});
</script>
