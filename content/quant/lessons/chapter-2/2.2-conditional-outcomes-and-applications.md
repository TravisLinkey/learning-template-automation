---
title: "Conditional Outcomes and Applications"
chapter: 2
lesson: 2
author: "Quant Probability Team"
date: "2025-01-15"
description: "Advanced applications of conditional probability in quantitative finance, including conditional outcomes and complex scenarios"
---

# 2.2 — Conditional Outcomes and Applications

In the previous lesson (2.1), we learned the fundamentals of conditional probability and how it relates to dependent events. Now we'll explore advanced applications of conditional probability, focusing on calculating probabilities of outcomes under various conditions and applying these concepts to complex financial scenarios. This lesson builds on the multiplication rule and chain rule from lesson 2.1.

## Conditional Outcomes

A **conditional outcome** is an outcome whose probability depends on the occurrence of another event. Understanding conditional outcomes is crucial for modeling dependent systems in quantitative finance.

### Example 1: Market Regime Dependencies

Consider stock returns that depend on market conditions:

- **Bull Market** (probability 0.6):
  - Stock goes up: 0.8
  - Stock goes down: 0.15
  - Stock unchanged: 0.05

- **Bear Market** (probability 0.4):
  - Stock goes up: 0.2
  - Stock goes down: 0.7
  - Stock unchanged: 0.1

**Question:** What is the unconditional probability that the stock goes up?

**Solution using Law of Total Probability:**

Let:
- $M_B$ = "Bull market": $P(M_B) = 0.6$
- $M_{Bear}$ = "Bear market": $P(M_{Bear}) = 0.4$
- $U$ = "Stock goes up"

$$P(U) = P(U | M_B) \cdot P(M_B) + P(U | M_{Bear}) \cdot P(M_{Bear})$$

$$P(U) = 0.8 \cdot 0.6 + 0.2 \cdot 0.4 = 0.48 + 0.08 = 0.56$$

**Interpretation:** The unconditional probability of the stock going up is 56%, which is a weighted average of the conditional probabilities.

### Example 2: Portfolio Performance by Sector

A portfolio contains stocks from two sectors:

- **Technology Sector** (60% of portfolio):
  - High return: 0.4
  - Medium return: 0.5
  - Low return: 0.1

- **Finance Sector** (40% of portfolio):
  - High return: 0.3
  - Medium return: 0.4
  - Low return: 0.3

**Question:** What is the probability of a high return from the portfolio?

**Solution:**

Let:
- $T$ = "Technology sector": $P(T) = 0.6$
- $F$ = "Finance sector": $P(F) = 0.4$
- $H$ = "High return"

$$P(H) = P(H | T) \cdot P(T) + P(H | F) \cdot P(F)$$

$$P(H) = 0.4 \cdot 0.6 + 0.3 \cdot 0.4 = 0.24 + 0.12 = 0.36$$

## Conditional Probability Trees

Probability trees are visual tools for understanding conditional outcomes and complex probability scenarios.

### Example: Trading Strategy Performance

A trading strategy has two phases:

**Phase 1:** Signal Generation
- Strong signal: probability 0.3
- Weak signal: probability 0.7

**Phase 2:** Trade Execution (conditional on signal)
- If strong signal:
  - Win: 0.7
  - Loss: 0.3
- If weak signal:
  - Win: 0.4
  - Loss: 0.6

**Probability Tree:**

```
                    Win: 0.7
                   /
        Strong: 0.3
       /          \
      /            Loss: 0.3
Start
      \            Win: 0.4
       \          /
        Weak: 0.7
                   \
                    Loss: 0.6
```

**Calculations:**

- $P(\text{Strong signal and Win}) = 0.3 \cdot 0.7 = 0.21$
- $P(\text{Strong signal and Loss}) = 0.3 \cdot 0.3 = 0.09$
- $P(\text{Weak signal and Win}) = 0.7 \cdot 0.4 = 0.28$
- $P(\text{Weak signal and Loss}) = 0.7 \cdot 0.6 = 0.42$

**Unconditional Win Probability:**

$$P(\text{Win}) = 0.21 + 0.28 = 0.49$$

## Reversing Conditional Probabilities

Sometimes we need to reverse conditional probabilities. For example, if we know $P(B | A)$, we might want to find $P(A | B)$.

### Example: Credit Default Analysis

A bank analyzes loan defaults:

- $A$ = "Borrower is high-risk": $P(A) = 0.1$
- $B$ = "Loan defaults": $P(B) = 0.02$ (unconditional)
- $P(B | A) = 0.15$ (default probability for high-risk borrowers)

**Question:** If a loan defaults, what is the probability the borrower was high-risk?

**Solution using conditional probability (we'll learn this formally as Bayes' Theorem in Chapter 3):**

$$P(A | B) = \frac{P(B | A) \cdot P(A)}{P(B)} = \frac{0.15 \cdot 0.1}{0.02} = \frac{0.015}{0.02} = 0.75$$

**Interpretation:** Among defaulted loans, 75% were from high-risk borrowers, even though high-risk borrowers only represent 10% of all borrowers.

## Multiple Conditional Scenarios

Real-world financial problems often involve multiple conditions and outcomes.

### Example: Multi-Factor Risk Model

A risk model considers three factors:

**Factor 1: Market Volatility**
- High volatility: $P(V_H) = 0.3$
- Low volatility: $P(V_L) = 0.7$

**Factor 2: Economic Growth (conditional on volatility)**
- If high volatility:
  - Recession: $P(R | V_H) = 0.6$
  - Growth: $P(G | V_H) = 0.4$
- If low volatility:
  - Recession: $P(R | V_L) = 0.2$
  - Growth: $P(G | V_L) = 0.8$

**Factor 3: Portfolio Return (conditional on volatility and growth)**
- If high volatility and recession: $P(\text{Loss} | V_H \cap R) = 0.8$
- If high volatility and growth: $P(\text{Loss} | V_H \cap G) = 0.5$
- If low volatility and recession: $P(\text{Loss} | V_L \cap R) = 0.4$
- If low volatility and growth: $P(\text{Loss} | V_L \cap G) = 0.1$

**Question:** What is the unconditional probability of a portfolio loss?

**Solution:**

We need to calculate probabilities for all combinations:

1. $P(V_H \cap R) = P(V_H) \cdot P(R | V_H) = 0.3 \cdot 0.6 = 0.18$
2. $P(V_H \cap G) = P(V_H) \cdot P(G | V_H) = 0.3 \cdot 0.4 = 0.12$
3. $P(V_L \cap R) = P(V_L) \cdot P(R | V_L) = 0.7 \cdot 0.2 = 0.14$
4. $P(V_L \cap G) = P(V_L) \cdot P(G | V_L) = 0.7 \cdot 0.8 = 0.56$

Now calculate loss probability:

$$P(\text{Loss}) = P(\text{Loss} | V_H \cap R) \cdot P(V_H \cap R) + P(\text{Loss} | V_H \cap G) \cdot P(V_H \cap G) + P(\text{Loss} | V_L \cap R) \cdot P(V_L \cap R) + P(\text{Loss} | V_L \cap G) \cdot P(V_L \cap G)$$

$$P(\text{Loss}) = 0.8 \cdot 0.18 + 0.5 \cdot 0.12 + 0.4 \cdot 0.14 + 0.1 \cdot 0.56$$

$$P(\text{Loss}) = 0.144 + 0.06 + 0.056 + 0.056 = 0.316$$

**Interpretation:** The unconditional probability of a portfolio loss is 31.6%.

## Conditional Expectations

In quantitative finance, we often work with **conditional expectations**—the expected value of a random variable given that an event has occurred.

### Example: Expected Return by Market Condition

Stock returns depend on market conditions:

- **Bull Market** (probability 0.6):
  - Expected return: 15%
- **Bear Market** (probability 0.4):
  - Expected return: -5%

**Unconditional Expected Return:**

$$E[\text{Return}] = E[\text{Return} | \text{Bull}] \cdot P(\text{Bull}) + E[\text{Return} | \text{Bear}] \cdot P(\text{Bear})$$

$$E[\text{Return}] = 0.15 \cdot 0.6 + (-0.05) \cdot 0.4 = 0.09 - 0.02 = 0.07$$

**Interpretation:** The unconditional expected return is 7%, which is a weighted average of the conditional expectations.

## Financial Applications

### Risk-Adjusted Probabilities

**Example:** Adjusting probabilities based on risk factors

- Base default probability: $P(D) = 0.02$
- Given high leverage: $P(D | L) = 0.08$
- Given economic downturn: $P(D | E) = 0.12$
- Given both: $P(D | L \cap E) = 0.25$

This allows for more accurate risk assessment under different scenarios.

### Portfolio Optimization

**Example:** Asset allocation based on market conditions

- In bull markets: Allocate 70% to stocks
- In bear markets: Allocate 30% to stocks
- In neutral markets: Allocate 50% to stocks

Conditional probabilities help determine optimal allocation strategies.

### Trading Signal Analysis

**Example:** Evaluating trading signals

- Signal accuracy in trending markets: $P(\text{Correct} | \text{Trend}) = 0.75$
- Signal accuracy in ranging markets: $P(\text{Correct} | \text{Range}) = 0.45$

Understanding conditional probabilities helps assess signal reliability under different market conditions.

## Python Implementation

```python
def law_of_total_probability(conditional_probs, prior_probs):
    """
    Calculate unconditional probability using Law of Total Probability
    
    P(B) = sum over i of P(B | A_i) * P(A_i)
    
    Parameters:
    conditional_probs: List of P(B | A_i) for each condition A_i
    prior_probs: List of P(A_i) for each condition
    
    Returns:
    Unconditional probability P(B)
    """
    if len(conditional_probs) != len(prior_probs):
        raise ValueError("Lists must have same length")
    
    return sum(c * p for c, p in zip(conditional_probs, prior_probs))

def conditional_expectation(conditional_expectations, prior_probs):
    """
    Calculate unconditional expectation using Law of Total Expectation
    
    E[X] = sum over i of E[X | A_i] * P(A_i)
    
    Parameters:
    conditional_expectations: List of E[X | A_i] for each condition A_i
    prior_probs: List of P(A_i) for each condition
    
    Returns:
    Unconditional expectation E[X]
    """
    if len(conditional_expectations) != len(prior_probs):
        raise ValueError("Lists must have same length")
    
    return sum(e * p for e, p in zip(conditional_expectations, prior_probs))

def probability_tree(levels):
    """
    Calculate probabilities for a multi-level probability tree
    
    Parameters:
    levels: List of levels, where each level is a list of (probability, label) tuples
    
    Returns:
    Dictionary mapping paths to probabilities
    """
    results = {}
    
    def traverse(path, prob, level_idx):
        if level_idx == len(levels):
            results[tuple(path)] = prob
            return
        
        for branch_prob, label in levels[level_idx]:
            new_path = path + [label]
            new_prob = prob * branch_prob
            traverse(new_path, new_prob, level_idx + 1)
    
    traverse([], 1.0, 0)
    return results

# Example 1: Market regime dependencies
conditional_probs = [0.8, 0.2]  # P(up | bull), P(up | bear)
prior_probs = [0.6, 0.4]  # P(bull), P(bear)
p_up = law_of_total_probability(conditional_probs, prior_probs)
print(f"P(stock up) = {p_up:.2f}")

# Example 2: Expected return
conditional_returns = [0.15, -0.05]  # E[return | bull], E[return | bear]
expected_return = conditional_expectation(conditional_returns, prior_probs)
print(f"E[return] = {expected_return:.2%}")

# Example 3: Probability tree
levels = [
    [(0.3, "Strong"), (0.7, "Weak")],  # Phase 1
    [(0.7, "Win"), (0.3, "Loss")],  # Phase 2 (for strong)
    [(0.4, "Win"), (0.6, "Loss")]   # Phase 2 (for weak)
]

# Note: This is a simplified example. In practice, you'd need to handle
# different branches for different conditions
tree_results = {
    ("Strong", "Win"): 0.3 * 0.7,
    ("Strong", "Loss"): 0.3 * 0.3,
    ("Weak", "Win"): 0.7 * 0.4,
    ("Weak", "Loss"): 0.7 * 0.6
}

print("\nProbability Tree Results:")
for path, prob in tree_results.items():
    print(f"{' -> '.join(path)}: {prob:.2f}")

p_win = tree_results[("Strong", "Win")] + tree_results[("Weak", "Win")]
print(f"\nP(Win) = {p_win:.2f}")
```

## Common Mistakes

1. **Confusing conditional and unconditional probabilities**
   - **Wrong:** Using $P(B)$ when you need $P(B | A)$
   - **Fix:** Always identify what information is given

2. **Incorrect application of Law of Total Probability**
   - **Wrong:** Not ensuring conditions are mutually exclusive and exhaustive
   - **Fix:** Verify that $\sum P(A_i) = 1$ and $A_i \cap A_j = \emptyset$ for $i \neq j$

3. **Reversing conditions incorrectly**
   - **Wrong:** Assuming $P(A | B) = P(B | A)$
   - **Fix:** Use the formula $P(A | B) = \frac{P(B | A) \cdot P(A)}{P(B)}$ to reverse conditions (we'll learn this as Bayes' Theorem in Chapter 3)

4. **Ignoring dependencies in probability trees**
   - **Wrong:** Using same probabilities for all branches
   - **Fix:** Adjust probabilities based on previous outcomes

## Key Takeaways

1. **Conditional Outcomes**: Outcomes whose probabilities depend on other events
2. **Law of Total Probability**: $P(B) = \sum_i P(B | A_i) \cdot P(A_i)$ for mutually exclusive, exhaustive $A_i$
3. **Probability Trees**: Visual tools for complex conditional scenarios
4. **Conditional Expectations**: $E[X] = \sum_i E[X | A_i] \cdot P(A_i)$
5. **Financial Applications**: Risk assessment, portfolio optimization, trading signals

## Next Steps

In the next chapter, we'll learn **Bayes' Theorem** and the **Law of Total Probability** formally, which provide powerful tools for updating probabilities and making decisions under uncertainty—essential skills for quantitative finance.

