---
title: "Command-Line Mode — Ex Commands"
chapter: 1
lesson: 4
author: "Vim Learning Team"
date: "2025-01-19"
description: "Master Vim's command-line mode for file operations, substitutions, and powerful Ex commands"
---

# 1.4 — Command-Line Mode — Ex Commands

Command-line mode gives you access to Vim's powerful Ex commands. These commands handle file operations, search and replace, settings, and much more.

## What is Command-Line Mode?

**Command-line mode** (also called **Ex mode** or **Cmdline mode**) is activated by pressing `:`, `/`, or `?` from Normal mode. A command line appears at the bottom of the screen where you type commands.

| Entry Key | Purpose | Prompt |
|-----------|---------|--------|
| `:` | Ex commands | `:` |
| `/` | Search forward | `/` |
| `?` | Search backward | `?` |

## Essential Ex Commands

### File Operations

| Command | Action |
|---------|--------|
| `:w` | Write (save) file |
| `:w filename` | Write to filename |
| `:q` | Quit |
| `:q!` | Quit without saving |
| `:wq` or `:x` | Write and quit |
| `:e filename` | Edit (open) file |
| `:e!` | Reload file, discard changes |
| `:r filename` | Read file into buffer |
| `:r !command` | Read command output into buffer |

### Navigation

| Command | Action |
|---------|--------|
| `:10` | Go to line 10 |
| `:$` | Go to last line |
| `:.` | Current line |
| `:%` | All lines (alias for `1,$`) |

### Buffer and Window Commands

| Command | Action |
|---------|--------|
| `:ls` or `:buffers` | List buffers |
| `:b N` | Switch to buffer N |
| `:bn` | Next buffer |
| `:bp` | Previous buffer |
| `:bd` | Delete (close) buffer |
| `:sp` | Horizontal split |
| `:vs` | Vertical split |
| `:close` | Close current window |
| `:only` | Close all other windows |

### Settings

| Command | Action |
|---------|--------|
| `:set option` | Enable option |
| `:set nooption` | Disable option |
| `:set option?` | Show option value |
| `:set option=value` | Set option value |

Common settings:
```vim
:set number          " Show line numbers
:set relativenumber  " Show relative line numbers
:set ignorecase      " Case-insensitive search
:set smartcase       " Case-sensitive if uppercase present
:set hlsearch        " Highlight search matches
:set nohlsearch      " Disable highlight
:set expandtab       " Use spaces instead of tabs
:set tabstop=4       " Tab width
:set shiftwidth=4    " Indent width
```

## Search Commands

### Basic Search

| Command | Action |
|---------|--------|
| `/pattern` | Search forward for pattern |
| `?pattern` | Search backward for pattern |
| `n` | Repeat search (same direction) |
| `N` | Repeat search (opposite direction) |
| `*` | Search forward for word under cursor |
| `#` | Search backward for word under cursor |

### Search Options

```vim
/pattern\c    " Case-insensitive search
/pattern\C    " Case-sensitive search
/\vpattern    " "Very magic" (regex without escaping)
```

### Clear Search Highlighting

```vim
:noh          " Clear highlight (short for :nohlsearch)
```

## Substitution (Search and Replace)

The substitute command is one of Vim's most powerful features.

### Basic Syntax

```vim
:[range]s/pattern/replacement/[flags]
```

### Ranges

| Range | Meaning |
|-------|---------|
| None | Current line |
| `%` | All lines |
| `1,10` | Lines 1-10 |
| `.,$` | Current line to end |
| `'<,'>` | Visual selection (auto-inserted) |

### Flags

| Flag | Meaning |
|------|---------|
| `g` | Global (all occurrences on line) |
| `c` | Confirm each substitution |
| `i` | Case-insensitive |
| `I` | Case-sensitive |
| `n` | Count matches, don't substitute |

### Examples

```vim
:s/old/new/           " First occurrence on current line
:s/old/new/g          " All occurrences on current line
:%s/old/new/g         " All occurrences in file
:%s/old/new/gc        " All occurrences, confirm each
:5,10s/old/new/g      " All occurrences on lines 5-10
:'<,'>s/old/new/g     " All occurrences in selection
```

### Special Replacement Patterns

| Pattern | Meaning |
|---------|---------|
| `&` | Entire matched pattern |
| `\1`, `\2` | Captured groups |
| `\u` | Uppercase next character |
| `\l` | Lowercase next character |
| `\U` | Uppercase until `\E` |
| `\L` | Lowercase until `\E` |

**Example**: Swap first and last name:
```vim
:%s/\(\w\+\) \(\w\+\)/\2, \1/g
" "John Doe" becomes "Doe, John"
```

## The Global Command

The `:g` command executes an Ex command on all lines matching a pattern.

### Syntax

```vim
:g/pattern/command
```

### Examples

```vim
:g/TODO/d             " Delete all lines containing "TODO"
:g/^$/d               " Delete all blank lines
:g/pattern/p          " Print all matching lines
:g!/pattern/d         " Delete lines NOT matching (or :v/pattern/d)
:g/error/t$           " Copy error lines to end of file
:g/function/normal A; " Append semicolon to lines containing "function"
```

## Command-Line Editing

While typing in command-line mode:

| Key | Action |
|-----|--------|
| `Esc` or `Ctrl-c` | Cancel and return to Normal mode |
| `Enter` | Execute command |
| `Ctrl-b` | Move to beginning of line |
| `Ctrl-e` | Move to end of line |
| `Ctrl-w` | Delete word before cursor |
| `Ctrl-u` | Delete to beginning of line |
| `Up` / `Ctrl-p` | Previous command in history |
| `Down` / `Ctrl-n` | Next command in history |
| `Ctrl-r Ctrl-w` | Insert word under cursor |

## Command History

Vim remembers your commands. Access history with:

- `q:` — Open command history window
- `q/` — Open search history window
- `:` then `Up`/`Down` — Cycle through command history

Filter history by typing first characters:
```vim
:e <Up>    " Cycle through commands starting with :e
```

## External Commands

Run shell commands from Vim:

| Command | Action |
|---------|--------|
| `:!command` | Run command, show output |
| `:r !command` | Insert command output |
| `:.!command` | Filter line through command |
| `:%!command` | Filter buffer through command |

**Examples**:
```vim
:!ls                  " List files
:r !date              " Insert current date
:.!sort               " Sort current line (not useful)
:%!sort               " Sort entire file
:'<,'>!sort           " Sort selected lines
```

## Practice Exercises

### Exercise 1: File Operations
1. Open Vim: `vim`
2. Type some text
3. `:w test.txt` to save
4. `:e test.txt` to reopen
5. Make changes, `:w` to save
6. `:q` to quit

### Exercise 2: Search
1. Open a file with text
2. `/word` to search for "word"
3. Press `n` to find next occurrence
4. Press `N` to find previous
5. `:noh` to clear highlighting

### Exercise 3: Substitution
1. Create text: "Hello World Hello World Hello"
2. `:s/Hello/Hi/` — replaces first Hello
3. `u` to undo
4. `:s/Hello/Hi/g` — replaces all on line
5. `u` to undo
6. `:%s/Hello/Hi/gc` — all in file, with confirmation

### Exercise 4: Global Command
1. Create a file with various lines
2. Add "TODO" to some lines
3. `:g/TODO/p` — print TODO lines
4. `:g/TODO/d` — delete TODO lines
5. `u` to undo

### Exercise 5: External Commands
1. `:r !date` — insert current date
2. `:r !ls` — insert file listing
3. Select lines with `V`
4. `:'<,'>!sort` — sort selected lines

## Summary

| Category | Commands |
|----------|----------|
| **File Ops** | `:w`, `:q`, `:e`, `:wq` |
| **Search** | `/pattern`, `?pattern`, `n`, `N` |
| **Substitute** | `:%s/old/new/g` |
| **Global** | `:g/pattern/command` |
| **Settings** | `:set option` |
| **External** | `:!command` |

Command-line mode transforms Vim from a text editor into a text processing powerhouse. Master these commands to handle complex editing tasks efficiently.
